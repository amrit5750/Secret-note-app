services:
  mongo:
    image: mongo:6
    restart: unless-stopped
    volumes:
      - /apps/secret-note-data/mongo:/data/db
    networks: [appnet]
    logging:
      { driver: "json-file", options: { max-size: "10m", max-file: "5" } }

  backend:
    build: ./apps/backend
    env_file: ./apps/backend/.env
    depends_on: [mongo]
    restart: unless-stopped
    networks: [appnet]
    logging:
      { driver: "json-file", options: { max-size: "10m", max-file: "5" } }

  frontend:
    build: ./apps/frontend
    env_file: ./apps/frontend/.env
    depends_on: [backend]
    restart: unless-stopped
    networks: [appnet]
    logging:
      { driver: "json-file", options: { max-size: "10m", max-file: "5" } }

  nginx:
    image: nginx:latest
    container_name: nginx-proxy
    restart: always
    depends_on: [frontend, backend]
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      # OPTION 1: put your certs in the repo at ./nginx/ssl/
      - ./nginx/ssl:/etc/nginx/ssl:ro
      # OPTION 2 (alternate): reuse host cert dir instead of copying
      # - /etc/ssl/cryptnote:/etc/nginx/ssl:ro
    networks: [appnet]
    logging:
      { driver: "json-file", options: { max-size: "10m", max-file: "5" } }

networks:
  appnet:
